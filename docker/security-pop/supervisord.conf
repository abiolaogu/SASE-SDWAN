[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid
loglevel=info

# ============================================
# Suricata IPS
# ============================================
[program:suricata]
command=/usr/bin/suricata -c /etc/suricata/suricata.yaml -i eth0 --init-errors-fatal
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/suricata/suricata-stdout.log
stderr_logfile=/var/log/suricata/suricata-stderr.log
startsecs=5
startretries=3

# ============================================
# Unbound DNS Resolver
# ============================================
[program:unbound]
command=/usr/sbin/unbound -d -c /etc/unbound/unbound.conf
autostart=true
autorestart=true
priority=20
stdout_logfile=/var/log/unbound/unbound-stdout.log
stderr_logfile=/var/log/unbound/unbound-stderr.log
startsecs=3

# ============================================
# Squid Proxy (SWG-lite)
# ============================================
[program:squid]
command=/usr/sbin/squid -NYC -f /etc/squid/squid.conf
autostart=true
autorestart=true
priority=30
stdout_logfile=/var/log/squid/squid-stdout.log
stderr_logfile=/var/log/squid/squid-stderr.log
startsecs=5

# ============================================
# nftables Firewall
# ============================================
[program:nftables]
command=/bin/sh -c "nft -f /etc/nftables.conf && sleep infinity"
autostart=true
autorestart=false
priority=5
stdout_logfile=/var/log/nftables.log
stderr_logfile=/var/log/nftables-err.log
startsecs=1

# ============================================
# Node Exporter (Prometheus Metrics)
# ============================================
[program:node_exporter]
command=/usr/bin/node_exporter --web.listen-address=:9100
autostart=true
autorestart=true
priority=40
stdout_logfile=/var/log/node_exporter.log
stderr_logfile=/var/log/node_exporter-err.log

# ============================================
# Management API
# ============================================
[program:api]
command=/usr/bin/python3 /opt/api/app.py
autostart=true
autorestart=true
priority=50
stdout_logfile=/var/log/api-stdout.log
stderr_logfile=/var/log/api-stderr.log
directory=/opt/api
environment=PYTHONUNBUFFERED="1"
startsecs=3
