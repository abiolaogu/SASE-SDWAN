# OpenSASE VPP Engine - Interface Setup Configuration
# Executed after VPP startup via startup-config directive
#
# File: /etc/vpp/setup.conf

# ===============================================================
# INTERFACE CONFIGURATION
# ===============================================================

# Enable WAN interface
set interface state wan0 up
set interface mtu 9000 wan0
set interface promiscuous on wan0

# Enable LAN interface  
set interface state lan0 up
set interface mtu 9000 lan0
set interface promiscuous on lan0

# Create loopback for management
create loopback interface
set interface state loop0 up
set interface ip address loop0 10.255.255.1/32

# ===============================================================
# OPENSASE FEATURE ACTIVATION
# ===============================================================

# Enable OpenSASE SASE pipeline on interfaces
# This inserts our graph nodes into the IPv4 unicast path
set interface feature wan0 ip4-unicast opensase-tenant
set interface feature lan0 ip4-unicast opensase-tenant

# ===============================================================
# IP ROUTING
# ===============================================================

# Example: Default route via WAN gateway
# ip route add 0.0.0.0/0 via 198.51.100.1

# Example: Internal routes via LAN
# ip route add 10.0.0.0/8 via lan0

# ===============================================================
# TENANT CONFIGURATION
# ===============================================================

# Map source IP prefixes to tenant IDs
# Format: opensase tenant add <prefix>/<len> tenant <id> [vrf <id>]

# Example tenant mappings:
# opensase tenant add 10.1.0.0/16 tenant 1
# opensase tenant add 10.2.0.0/16 tenant 2
# opensase tenant add 192.168.0.0/16 tenant 3

# ===============================================================
# NAT POOL CONFIGURATION
# ===============================================================

# Configure public IP pools for NAT per tenant
# Format: opensase nat pool tenant <id> address <ip> ports <start>-<end>

# Example NAT pools:
# opensase nat pool tenant 1 address 203.0.113.1 ports 10000-40000
# opensase nat pool tenant 2 address 203.0.113.2 ports 10000-40000
# opensase nat pool tenant 3 address 203.0.113.3 ports 10000-40000

# ===============================================================
# WIREGUARD TUNNELS
# ===============================================================

# Create WireGuard tunnels to remote PoPs
# Format: opensase tunnel create local <ip> remote <ip> [wireguard|vxlan] interface <if>

# Example WireGuard tunnel to PoP:
# opensase tunnel create local 203.0.113.1 remote 198.51.100.1 wireguard interface wan0

# ===============================================================
# QOS RATE LIMITS
# ===============================================================

# Configure rate limits per tenant and QoS class
# Format: opensase qos rate-limit tenant <id> class <0-4> rate <mbps>
# Classes: 0=realtime, 1=business, 2=default, 3=bulk, 4=scavenger

# Example rate limits:
# opensase qos rate-limit tenant 1 class 4 rate 1000
# opensase qos rate-limit tenant 2 class 4 rate 500

# ===============================================================
# POLICY CONFIGURATION
# ===============================================================

# Policies loaded from management plane via API
# Manual CLI examples:

# Allow all from tenant 1
# opensase policy add priority 100 tenant 1 src any dst any action allow

# Block known malicious ranges
# opensase policy add priority 10 src any dst 198.51.100.0/24 action deny

# Force DLP inspection for sensitive destinations
# opensase policy add priority 50 src 10.0.0.0/8 dst any port 443 action inspect-dlp

# ===============================================================
# VERIFICATION
# ===============================================================

# Display configuration
show interface
show interface address
show ip fib
show opensase version
