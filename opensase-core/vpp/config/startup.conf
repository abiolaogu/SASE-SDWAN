# OpenSASE VPP Engine - Startup Configuration
# Optimized for 100+ Gbps dedicated server deployment

unix {
  nodaemon
  interactive
  cli-listen /run/vpp/cli.sock
  gid vpp
  
  # Execute interface configuration after startup
  exec /etc/vpp/interfaces.conf
  
  # Coredump configuration
  coredump-size unlimited
  full-coredump
}

api-segment {
  gid vpp
  # Shared memory size for API
  global-size 256M
  api-size 64M
}

# CPU configuration - adjust based on your server
# Example: 32-core EPYC with 2 NUMA nodes
cpu {
  # Main thread on core 0
  main-core 0
  
  # Worker threads on remaining cores
  # For 32 cores: use 1-31 for workers
  corelist-workers 1-15,17-31
  
  # Skip core 16 (NUMA boundary on some systems)
  skip-core 16
}

# Buffer configuration for high-performance
buffers {
  # Increase buffer pool size for high PPS
  buffers-per-numa 131072
  
  # Buffer size (default 2048, can use 3000 for jumbo)
  default data-size 2048
}

# DPDK configuration for 100GbE NICs
dpdk {
  # Default device configuration
  dev default {
    # Number of RX/TX queues per interface
    num-rx-queues 16
    num-tx-queues 16
    
    # RX descriptor ring size
    num-rx-desc 4096
    
    # TX descriptor ring size
    num-tx-desc 4096
  }
  
  # First 100GbE NIC (adjust PCI address for your system)
  # Use 'lspci | grep -i ethernet' to find addresses
  dev 0000:81:00.0 {
    name net0
  }
  
  # Second 100GbE NIC
  dev 0000:81:00.1 {
    name net1
  }
  
  # Hugepage memory allocation per NUMA node (MB)
  # 8GB per NUMA for 2 NUMA nodes
  socket-mem 8192,8192
  
  # Performance optimizations
  no-multi-seg              # Disable multi-segment buffers
  no-tx-checksum-offload    # Software checksums (more predictable)
  
  # Uncomment for VLAN stripping
  # vlan-strip-offload on
}

# Plugin configuration
plugins {
  path /usr/lib/vpp_plugins
  
  # Enable OpenSASE plugins
  plugin opensase_plugin.so { enable }
  plugin wireguard_tunnel_plugin.so { enable }
  
  # Enable DPDK plugin (required)
  plugin dpdk_plugin.so { enable }
  
  # Disable unnecessary plugins for performance
  plugin acl_plugin.so { disable }
  plugin nat_plugin.so { disable }
  plugin lb_plugin.so { disable }
  
  # Keep crypto for WireGuard
  plugin crypto_native_plugin.so { enable }
  plugin crypto_openssl_plugin.so { enable }
}

# Logging
logging {
  default-log-level info
  default-syslog-log-level warning
  
  class opensase/all { level debug }
  class wireguard/all { level debug }
}

# Statistics segment (for prometheus/monitoring)
statseg {
  size 256M
  per-node-counters on
}

# Heap configuration
heapsize 4G
