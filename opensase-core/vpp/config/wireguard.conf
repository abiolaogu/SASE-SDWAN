# OpenSASE VPP Engine - WireGuard Tunnel Configuration
# 
# Example configuration for multi-PoP WireGuard mesh
#
# File: /etc/vpp/wireguard.conf

# ===============================================================
# WIREGUARD INTERFACE SETUP
# ===============================================================

# Create WireGuard interface on UDP port 51820
wireguard create interface listen-port 51820

# Bring up the WireGuard interface
set interface state wg0 up

# Assign IP address to WireGuard interface
set interface ip address wg0 10.100.0.1/24

# ===============================================================
# PEER CONFIGURATION - EXAMPLE MESH
# ===============================================================

# --- PoP 1: Frankfurt (this server) ---
# Private Key: [stored securely, not in config]
# Public Key: oKz3W8V+6XAuO5bGkz5xPjKq1h/9aNhRq8v2Sj5Wr1M=
# Endpoint: 198.51.100.1:51820
# Tunnel IP: 10.100.0.1/24

# --- PoP 2: London ---
wireguard peer add interface wg0 \
    public-key YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY= \
    endpoint 198.51.100.2:51820 \
    allowed-ip 10.100.0.2/32 \
    keepalive 25

# Route traffic for London PoP via tunnel
ip route add 10.100.0.2/32 via wg0
ip route add 10.2.0.0/16 via 10.100.0.2

# --- PoP 3: New York ---
wireguard peer add interface wg0 \
    public-key eHl6MTIzNDU2YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd= \
    endpoint 198.51.100.3:51820 \
    allowed-ip 10.100.0.3/32 \
    keepalive 25

ip route add 10.100.0.3/32 via wg0
ip route add 10.3.0.0/16 via 10.100.0.3

# --- PoP 4: Singapore ---
wireguard peer add interface wg0 \
    public-key cXJzdHV2d3h5ejEyMzQ1NmFiY2RlZmdoaWprbG1ub3A= \
    endpoint 198.51.100.4:51820 \
    allowed-ip 10.100.0.4/32 \
    keepalive 25

ip route add 10.100.0.4/32 via wg0
ip route add 10.4.0.0/16 via 10.100.0.4

# --- PoP 5: Tokyo ---
wireguard peer add interface wg0 \
    public-key bG1ub3BxcnN0dXZ3eHl6MTIzNDU2YWJjZGVmZ2hpams= \
    endpoint 198.51.100.5:51820 \
    allowed-ip 10.100.0.5/32 \
    keepalive 25

ip route add 10.100.0.5/32 via wg0
ip route add 10.5.0.0/16 via 10.100.0.5

# ===============================================================
# OPTIONAL: PRESHARED KEY FOR ADDITIONAL SECURITY
# ===============================================================

# For ultra-sensitive links, add preshared key:
# wireguard peer set interface wg0 public-key <key> preshared-key <psk>

# ===============================================================
# VERIFICATION COMMANDS
# ===============================================================

# Show WireGuard interfaces
show wireguard interface

# Show WireGuard tunnels (alias)
show wireguard tunnels

# Show routing table
show ip fib

# Ping remote PoP via tunnel
# ping 10.100.0.2 source 10.100.0.1
